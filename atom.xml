<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://yanchao0716.github.io</id>
    <title>yanchao&apos; blog</title>
    <updated>2020-02-27T13:54:49.513Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://yanchao0716.github.io"/>
    <link rel="self" href="https://yanchao0716.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://yanchao0716.github.io/images/avatar.png</logo>
    <icon>https://yanchao0716.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, yanchao&apos; blog</rights>
    <entry>
        <title type="html"><![CDATA[Spring @Scheduledçº¿ç¨‹æ¨¡å‹æ¢ç©¶ - æºç è¿½è¸ª]]></title>
        <id>https://yanchao0716.github.io/post/spring-scheduled-xian-cheng-mo-xing-tan-jiu-yuan-ma-zhui-zong/</id>
        <link href="https://yanchao0716.github.io/post/spring-scheduled-xian-cheng-mo-xing-tan-jiu-yuan-ma-zhui-zong/">
        </link>
        <updated>2020-02-27T13:49:15.000Z</updated>
        <content type="html"><![CDATA[<p>æ¥<a href="https://yanchao0716.github.io/post/spring-scheduled-xian-cheng-mo-xing-tan-jiu-fa-xian-wen-ti/">ä¸Šä¸€ç¯‡</a>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ @Scheduled è¿™ä¸ªå®šæ—¶å™¨çš„æ³¨è§£å®ç°</p>
<p>é¦–å…ˆæˆ‘çœ‹ä¸‹@Scheduledæ³¨è§£çš„å®šä¹‰</p>
<pre><code class="language-java">package org.springframework.scheduling.annotation;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Repeatable;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Repeatable(Schedules.class)
public @interface Scheduled {
	String CRON_DISABLED = &quot;-&quot;;
	String cron() default &quot;&quot;;
	String zone() default &quot;&quot;;
	long fixedDelay() default -1;
	String fixedDelayString() default &quot;&quot;;
	long fixedRate() default -1;
	String fixedRateString() default &quot;&quot;;
	long initialDelay() default -1;
	String initialDelayString() default &quot;&quot;;
}
</code></pre>
<p>æ³¨è§£çš„å­—æ®µåˆ†åˆ«å¯¹cronè¡¨è¾¾å¼ã€fixedDelayã€fixRateè¿›è¡Œäº†æ”¯æŒï¼Œå¯ä»¥ä¼ å…¥value</p>
<p>ç´§æ¥ç€æˆ‘ä»¬çœ‹ä¸‹@Scheduledåœ¨å“ªé‡Œè¢«ç”¨åˆ°ï¼Œè·Ÿè¿›å»æŸ¥çœ‹ä¸€ä¸‹å®ç°<br>
<img src="https://img-blog.csdnimg.cn/20200222151601696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ScheduledAnnotationBeanPostProcessorè¿™ä¸ªç±»ï¼Œå…¶ä»–å‡ ä¸ªç±»æˆ‘ä»¬ç¨åå†è¯´ã€‚<br>
<img src="https://img-blog.csdnimg.cn/20200222154351658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>ScheduledAnnotationBeanPostProcessoræ˜¯spring BeanPostProcessorçš„å®ç°ï¼ŒpostProcessAfterInitialization(Object bean, String beanName)æ–¹æ³•åœ¨Beanåˆå§‹åŒ–ä¹‹åæ‰§è¡Œã€‚</p>
<ol>
<li>æå–å®šæ—¶æ–¹æ³•ï¼šæŠ½å–@Scheduledæ³¨è§£ä»¥åŠè¢«æ³¨è§£çš„æ–¹æ³•</li>
<li>å¤„ç†å®šæ—¶æ–¹æ³•ï¼šå¯¹å®šæ—¶æ–¹æ³•è¿›è¡Œæ³¨å†Œå§”æ‰˜ç»™å®šæ—¶å™¨ï¼Œé€šè¿‡processScheduled()æ–¹æ³•å®ç°</li>
</ol>
<p>processScheduledæ–¹æ³•æå–äº†æ³¨è§£ä¸Šçš„å€¼ï¼Œcronã€fixedDelayã€fixRateåˆ†åˆ«åŒ…è£…æˆä¸åŒçš„å¯¹è±¡ï¼Œé€šè¿‡registrar.scheduleCronTaskæ–¹æ³•æ³¨å†Œåˆ°registrarä¸­</p>
<pre><code class="language-java">protected void processScheduled(Scheduled scheduled, Method method, Object bean) {
		 	Runnable runnable = createRunnable(bean, method);
			Set&lt;ScheduledTask&gt; tasks = new LinkedHashSet&lt;&gt;(4);
			
			// ç¡®å®šå®šæ—¶å™¨åˆå§‹å»¶è¿Ÿæ—¶é—´
			long initialDelay = scheduled.initialDelay();
			String initialDelayString = scheduled.initialDelayString();
			...
			initialDelay = parseDelayAsLong(initialDelayString);
			...

			// cronè¡¨è¾¾å¼å®ç°
			String cron = scheduled.cron();
			...
			tasks.add(this.registrar.scheduleCronTask(new CronTask(runnable, new CronTrigger(cron, timeZone))));
			...

			// fixed delayå®ç°
			long fixedDelay = scheduled.fixedDelay();
			...
			tasks.add(this.registrar.scheduleFixedDelayTask(new FixedDelayTask(runnable, fixedDelay, initialDelay)));
			...

			// fixed rateå®ç°
			long fixedRate = scheduled.fixedRate();
			...
			tasks.add(this.registrar.scheduleFixedRateTask(new FixedRateTask(runnable, fixedRate, initialDelay)));
			...
		}
	}
</code></pre>
<p>registraræ˜¯ScheduledTaskRegistrarç±»çš„å®ä¾‹ï¼ŒScheduledTaskRegistrarç±»ä¸»è¦ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-java">public class ScheduledTaskRegistrar implements ScheduledTaskHolder, InitializingBean, DisposableBean {
	private TaskScheduler taskScheduler;
	private ScheduledExecutorService localExecutor;
	private List&lt;TriggerTask&gt; triggerTasks;
	private List&lt;CronTask&gt; cronTasks;
	private List&lt;IntervalTask&gt; fixedRateTasks;
	private List&lt;IntervalTask&gt; fixedDelayTasks;
	private final Map&lt;Task, ScheduledTask&gt; unresolvedTasks = new HashMap&lt;&gt;(16);
	private final Set&lt;ScheduledTask&gt; scheduledTasks = new LinkedHashSet&lt;&gt;(16);
	
	public void setTaskScheduler(TaskScheduler taskScheduler){...}
	public void setScheduler(@Nullable Object scheduler) {...}
	
	public ScheduledTask scheduleCronTask(CronTask task) {...}
	public ScheduledTask scheduleFixedRateTask(FixedRateTask task) {...}
	public ScheduledTask scheduleFixedDelayTask(IntervalTask task) {...}
}
</code></pre>
<p>ä»¥cronä¸ºä¾‹æ³¨å†Œé€»è¾‘å®ç°å¦‚ä¸‹ï¼ŒæŠŠåŒ…è£…çš„Runnableæ–¹æ³•å’ŒTriggeräº¤ç”±taskSchedulerå¤„ç†<br>
<img src="https://img-blog.csdnimg.cn/20200222162128286.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>å†çœ‹ä¸‹TaskSchedulerè¿™é‡Œæ˜¯ä¸ªæ¥å£ï¼Œåˆ†åˆ«æä¾›äº†ä¸‰ç§æ¨¡å¼çš„å®šä¹‰å¦‚ä¸‹</p>
<pre><code class="language-java">public interface TaskScheduler {
	// ****** cronæ”¯æŒ  ******
	ScheduledFuture&lt;?&gt; schedule(Runnable task, Trigger trigger);
	ScheduledFuture&lt;?&gt; schedule(Runnable task, Date startTime);

	// ****** FixedRateæ”¯æŒ  ******
	ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable task, Date startTime, long period);
	ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable task, long period);
	
	// ****** FixedDelayæ”¯æŒ  ******
	ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable task, Date startTime, long delay);
	ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable task, long delay);

}
</code></pre>
<p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¤§æ¦‚æ˜ç™½äº†ï¼Œä¸Šé¢åˆ†æå¯ä»¥æ€»ç»“ä¸º    <em><strong>æå–å®šæ—¶æ–¹æ³•å§”æ‰˜ç»™taskScheduleræ‰§è¡Œ</strong></em>ã€‚è¿™ä¸ª***taskSchedulerçš„å®ç°æ‰æ˜¯çº¿ç¨‹æ¨¡å‹çš„å…³é”®***ã€‚åˆä¸Šè¾¹ScheduledTaskRegistrarç±»æˆ‘ä»¬å¯ä»¥çœ‹åˆ°taskScheduleræ˜¯é€šè¿‡setTaskSchedulerã€setScheduleræ–¹æ³•ä¼ å…¥çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°è¿™ä¿©æ–¹æ³•åœ¨ä¸Šé¢åœ°æ–¹è¢«è°ƒç”¨å³å¯ã€‚<br>
<img src="https://img-blog.csdnimg.cn/202002221657347.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><img src="https://img-blog.csdnimg.cn/20200222165749476.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>è¿™ä¿©æ–¹æ³•éƒ½æ˜¯åœ¨ScheduledAnnotationBeanPostProcessor#finishRegistrationå¤„è¢«è°ƒç”¨ï¼ŒfinishRegistrationåœ¨onApplicationEvent()é˜¶æ®µè¢«æ‰§è¡Œ<br>
<img src="https://img-blog.csdnimg.cn/2020022217035698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
å…·ä½“æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼Œæ³¨æ„ä¸¤å¤„åˆ¤æ–­é€»è¾‘ï¼Œå¦‚æœScheduledAnnotationBeanPostProcessorå®ä¾‹çš„schedulerä¸ä¸ºç©ºå°±æŠŠå®ƒè®¾ç½®ç»™ScheduledTaskRegistrarï¼Œå¦åˆ™è¿›å…¥ä¸‹é¢åŠ è½½é€»ã€‚<br>
<img src="https://img-blog.csdnimg.cn/20200222171355130.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>æŒ‰ç…§å…ˆç±»å‹ã€å†åç§°é¡ºåºä»å®¹å™¨ä¸­åˆ†åˆ«æŸ¥æ‰¾TaskSchedulerã€ScheduledExecutorServiceå¯¹è±¡<br>
<img src="https://img-blog.csdnimg.cn/20200222171726611.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>ä¸Šè¿°é€»è¾‘æ‰“æ–­ç‚¹å‘ç°é»˜è®¤é€šè¿‡this.registrar.setTaskScheduler(resolveSchedulerBean(this.beanFactory, TaskScheduler.class, false))æ–¹æ³•åŠ è½½åˆ°TaskSchedulerå®ä¾‹ï¼Œé€šè¿‡resolveNameBeanå¾—åˆ°ä¸€ä¸ªNameBeanHolderå®ä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“Spring é»˜è®¤ç±»åˆ«åä¸ºç±»åé¦–å­—æ¯å°å†™ï¼Œè¿™é‡Œä¼ å…¥ç±»å‹ä¸ºTaskSchedulerï¼Œholder.gerBeanName()ä¸ºtaskScheduler<br>
<img src="https://img-blog.csdnimg.cn/20200222172924489.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
TaskSchedulerçš„å®ç°æœ‰å¦‚ä¸‹ä¸‰ç§<br>
<img src="https://img-blog.csdnimg.cn/20200222175259578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
é€šè¿‡debugå‘ç°åŠ è½½çš„å®ä¾‹ä¸ºThreadPoolTaskSchedulerç±»å‹<br>
<img src="https://img-blog.csdnimg.cn/20200222174926204.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†***@Scheduledæ˜¯å¦‚ä½•è¢«è£…è½½å¤„ç†çš„*** ã€ <strong>å§”æ‰˜æ‰§è¡Œå¯¹è±¡(å®šæ—¶å™¨æ‰§è¡Œå•å…ƒ)æ˜¯å¦‚ä½•åŠ è½½çš„</strong>ä»¥åŠ***åŠ è½½çš„å¯¹è±¡æ˜¯ThreadPoolTaskSchedulerç±»å‹***ï¼Œé‚£ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯è¿™ä¸ªç±»å‹å‘¢ï¼Ÿåˆ«å¿˜äº†æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ³¨è§£@EnableSchedulingï¼Œè¿™ä¸ªæ³¨è§£æ˜¯å®šæ—¶ä»»åŠ¡çš„å¼€å…³ã€å¹¶ä¸”ä¼šè¿›è¡Œç¼ºçœé…ç½®ã€‚TaskSchedulingAutoConfigurationä¸ºè‡ªåŠ¨é…ç½®ç±»</p>
<p>ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½é»˜è®¤é…ç½®æ„é€ TaskSchedulerBuilderå¯¹è±¡å¹¶æ‰§è¡Œæ„å»ºæ–¹æ³•builderè¿›è¡Œæ„å»º<br>
<img src="https://img-blog.csdnimg.cn/20200222184333203.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>build()å®ç°<br>
<img src="https://img-blog.csdnimg.cn/20200222184922770.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
ThreadPoolTaskScheduleré»˜è®¤çº¿ç¨‹ä¸º1ï¼Œå†…éƒ¨ä¾èµ–JDK ScheduledExecutorServiceå®ç°<img src="https://img-blog.csdnimg.cn/20200222184956572.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"> <img src="https://img-blog.csdnimg.cn/20200222185028735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
createExecutor()å®ç°ï¼Œå¯ä»¥çœ‹åˆ°åˆ›å»ºäº†ä¸€ä¸ªScheduledExecutorServiceï¼Œé»˜è®¤poolSizeä¸º1<br>
<img src="https://img-blog.csdnimg.cn/2020022218542941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>ç”±æ­¤åˆ†æä¸éªŒè¯ç»“æœä¸€è‡´ã€‚<strong>@Scheduledæ³¨è§£é»˜è®¤é‡‡ç”¨å•çº¿ç¨‹æ‰§è¡Œï¼Œæ‰§è¡Œå•å…ƒæ˜¯Spring å®ç°çš„ThreadPoolTaskSchedulerå°è£…äº†JDK JUCè°ƒåº¦å™¨ScheduledExecutorServiceå®ç°ã€‚</strong></p>
<p>æœ€åå†å¾€å›ç¿»ä»£ç å‘ç°ï¼ŒScheduledAnnotationBeanPostProcessor#setScheduler(Object)æ–¹æ³•çš„æ³¨é‡Šå·²ç»è¯´çš„å¾ˆæ¸…æ¥šï¼Œå¦‚æœä¸è¿›è¡Œé…ç½®ï¼Œé»˜è®¤å®ç°ä¸ºå•çº¿ç¨‹ã€‚<br>
<img src="https://img-blog.csdnimg.cn/20200222190147831.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è§£å†³é—®é¢˜äº†ï¼Œè¯·è§ä¸‹ç¯‡ã€ŠSpring @Scheduledçº¿ç¨‹æ¨¡å‹æ¢ç©¶ - è§£å†³é—®é¢˜ã€‹ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring @Scheduledçº¿ç¨‹æ¨¡å‹æ¢ç©¶ - å‘ç°é—®é¢˜]]></title>
        <id>https://yanchao0716.github.io/post/spring-scheduled-xian-cheng-mo-xing-tan-jiu-fa-xian-wen-ti/</id>
        <link href="https://yanchao0716.github.io/post/spring-scheduled-xian-cheng-mo-xing-tan-jiu-fa-xian-wen-ti/">
        </link>
        <updated>2020-02-27T13:43:14.000Z</updated>
        <content type="html"><![CDATA[<p>æœ€è¿‘å·¥ç¨‹ä¸­å‘ç°ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œç®€å•ä»£ç é€»è¾‘å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-java">@EnableScheduling
@Component
public class SimpleImplement {
    private static final Logger LOG = LoggerFactory.getLogger(SimpleImplement.class);

    private volatile List&lt;String&gt; list = Collections.EMPTY_LIST;

    private final Queue&lt;Thread&gt; waiters = Queues.newConcurrentLinkedQueue();

    // å¦‚æœlistä¸ºç©ºæŒ‚èµ·çº¿ç¨‹
    public List&lt;String&gt; get(){
        while(CollectionUtils.isEmpty(list)){
            try {
                Thread current = Thread.currentThread();
                waiters.add(current);
                LOG.info(&quot;list ä¸ºç©ºæŒ‚èµ·çº¿ç¨‹ {}.&quot;, current.getName());
                LockSupport.park();
            }catch (Exception e){}
        }
        return list;
    }

    // å¼‚æ­¥æ›´æ–°listï¼Œå¦‚æœlistä¸ä¸ºç©ºåˆ™å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹
    @Scheduled(fixedDelay = 1000)
    private void sync(){
        // åŠ è½½æ•°æ®
        list = ...;
        if(CollectionUtils.isNotEmpty(list)){
            Thread waiter = null;
            while (!waiters.isEmpty()){
                waiter = waiters.remove();
                LOG.info(&quot;åŒæ­¥æ•°æ® list ä¸ä¸ºç©ºå”¤é†’çº¿ç¨‹ {}.&quot;, waiter.getName());
                LockSupport.unpark(waiter);
            }
        }
    }
</code></pre>
<p>ä¸Šè¾¹ä»£ç å¯¹listå¼‚æ­¥åŠ è½½ï¼Œè°ƒç”¨getæ¥å£çš„æ—¶å€™å¦‚æœlistä¸ºç©ºå°±æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œå¾…æœ‰æ•°æ®åŠ è½½æ—¶å†è¿›è¡Œå”¤é†’ã€‚æˆ‘ä»¬çŸ¥é“åŠ é”ä¹Ÿå¯ä»¥å®ç°ç­‰å¾…å”¤é†’ï¼Œè¿™é‡Œç”¨LockSupportæ˜¯å› ä¸ºè¿™é‡Œæ˜¯å¼‚æ­¥åŠ è½½æ•°æ®ä¸å­˜åœ¨æ•°æ®ç«äº‰é—®é¢˜ï¼ŒåŠ é”ä¼šè®©å¤šä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œå½±å“ä»»åŠ¡æ‰§è¡Œæ•ˆç‡ã€‚</p>
<p><em><strong>é—®é¢˜</strong></em><br>
get()æ¥å£åœ¨å·¥ç¨‹ä¸­å¥½å‡ å¤„è¢«è°ƒç”¨ï¼Œæµ‹è¯•å‘ç°è¢«æŒ‚èµ·çš„çº¿ç¨‹æœ‰æ—¶ä¼šå”¤é†’å¤±è´¥ã€‚åå¤æµ‹è¯•å‡ æ¬¡ä»æ—¥å¿—ä¸­çœ‹è¢«é˜»å¡çš„çº¿ç¨‹éƒ½æ˜¯ scheduling-1ï¼Œçœ‹èµ·åƒæ˜¯å®šæ—¶å™¨çš„çº¿ç¨‹ã€‚äºæ˜¯ç¿»çœ‹äº†ä»£ç å‘ç°å‡ å¤„è°ƒç”¨get()æ¥å£çš„åœ°æ–¹éƒ½é‡‡ç”¨@Scheduledæ³¨è§£è¿›è¡Œå‘¨æœŸè½®è¯¢ã€‚</p>
<p><em><strong>åˆ†æ</strong></em><br>
æ€€ç–‘è¿™é‡Œå¯èƒ½æ˜¯@Scheduledçš„å®ç°æ˜¯å•çº¿ç¨‹ï¼Œå‡ å¤„å®šæ—¶ä»»åŠ¡éƒ½æ˜¯æœ‰åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æœè¿™æ ·è°ƒç”¨sync()æ¥å£çš„çº¿ç¨‹ä¹Ÿæ˜¯è°ƒç”¨get()æ¥å£çš„çº¿ç¨‹ï¼Œå¦‚æœè¢«é˜»å¡é‚£ä¹ˆå”¤é†’åŠ¨ä½œå°±ä¸€ç›´å¾—ä¸åˆ°æ‰§è¡Œã€‚</p>
<p><em><strong>éªŒè¯</strong></em><br>
ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•ï¼Œå†™äº†ä¸ªç®€å•çš„æµ‹è¯•ä»£ç åŠç»“æœå¦‚ä¸‹:</p>
<pre><code class="language-java">@Component
@EnableScheduling
public class ScheduledTest {
    private static Logger LOG = LoggerFactory.getLogger(ScheduledTest.class);

    @Scheduled(fixedDelay = 1000)
    public void method1(){
        LOG.info(&quot;çº¿ç¨‹ {} æ‰§è¡Œmethod1 .&quot;, Thread.currentThread().getName());
    }

    @Scheduled(fixedDelay = 1000)
    public void method2(){
        LOG.info(&quot;çº¿ç¨‹ {} æ‰§è¡Œmethod2 .&quot;, Thread.currentThread().getName());
    }
}
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/2020022214412263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5YzkyMDcxNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
æµ‹è¯•å‘ç°@Scheduledæ³¨è§£ç¡®å®æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œæ‰§è¡Œmethod1å’Œmethod2çš„çº¿ç¨‹éƒ½æ˜¯scheduing-1ï¼Œå¹¶ä¸”åœ¨æ‰“å°å®Œmethod1æ‰§è¡Œçš„logå5ç§’æ‰æ‰“å°method2çš„logï¼Œè¯´æ˜åœ¨è¿™é‡Œscheduling-1åœ¨method1è¢«é˜»å¡äº†5ç§’ã€‚</p>
<p>è¿™é‡Œåˆšå¥½éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³ï¼š<strong>è¢«æŒ‚èµ·çš„çº¿ç¨‹æ²¡æœ‰è¢«å”¤é†’ï¼Œæ˜¯å› ä¸ºæ‰§è¡Œå”¤é†’å’Œè¢«æŒ‚èµ·çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</strong>ã€‚</p>
<p>ç°åœ¨å·²ç»ç¡®å®šé—®é¢˜äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆæ”¹ã€‚æ”¹ä¹‹å‰å»ç¿»çœ‹ä¸‹æºç æ‰¾åˆ°é—®é¢˜çš„æ ¹æºï¼Œæ‰èƒ½æ›´å¥½çš„è§£å†³é—®é¢˜ï¼Œæºç åˆ†ææ¥ä¸‹ç¯‡<a href="https://blog.csdn.net/zyc920716/article/details/104444109">ã€ŠSpring @Scheduledçº¿ç¨‹æ¨¡å‹æ¢ç©¶ - æºç è¿½è¸ªã€‹</a>ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://yanchao0716.github.io/post/hello-gridea/</id>
        <link href="https://yanchao0716.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>